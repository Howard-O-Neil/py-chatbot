# this compose file use for dev only

version: "3.5"

services:
  py-chatbot-application:
    depends_on:
      - "py-chatbot-database"
    restart: always
    networks:
      - py-chatbot
    hostname: py-chatbot-application
    build:
      context: .
      dockerfile: dockerfile
    ports:
      - "8082:5000"
    env_file:
      - development.env
    volumes: # live reload from soure code
      - ./application:/home/app/application
      - ./entities:/home/app/entities
      - ./gunicorn.error.log:/home/app/gunicorn.error.log
      - ./gunicorn.log:/home/app/gunicorn.log
    command: gunicorn -w 2 -b :5000 -c gunicorn.config.py app:app
  py-chatbot-database:
    image: postgres:13.3-alpine
    restart: always
    networks:
      - py-chatbot
    hostname: py-chatbot-database
    ports:
      - "5432:5432"
      - "5433:5433"
    env_file:
      - development.env
    volumes:
      - ./pgdata:/var/lib/postgresql/data

  py-chatbot-adminer:
    depends_on:
      - "py-chatbot-database"
    image: adminer:4.8.0-standalone
    restart: always
    networks:
      - py-chatbot
    hostname: py-chatbot-adminer
    ports:
      - "8080:8080"

networks:
  py-chatbot:
    ipam:
      driver: default
      config:
        - subnet: "10.2.0.0/27"